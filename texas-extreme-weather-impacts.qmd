---
title: "Houston Blackouts February 2021"
format: docx
author: "Sofia Rodas"
date: "November 10, 2025"
message: false
warning: false
---
# Homes in Houston Affected by February 2021 Electricity Outages
```{r}
#| output: false

# load in libraries
library(tidyverse)
library(tmap) # map making
library(sf)
library(stars) # raster handling
library(terra) # raster handling
```
## Read in the data 
Read in Nasa's Worldview data that will be used to analyze the effects of the power outages in Texas. February 7, 2021 and February 16, 2021 are the two dates analyzed as they provide clear skies for better analysis.
```{r}
#| output: false

# read in the NASA data
light1_0207 <- read_stars(here::here("data/VNP46A1/VNP46A1.A2021038.h08v05.001.2021039064328.tif"))
light2_0207 <- read_stars(here::here("data/VNP46A1/VNP46A1.A2021038.h08v06.001.2021039064329.tif"))
light3_0216 <- read_stars(here::here("data/VNP46A1/VNP46A1.A2021047.h08v05.001.2021048091106.tif"))
light4_0216 <- read_stars(here::here("data/VNP46A1/VNP46A1.A2021047.h08v06.001.2021048091105.tif"))
```
Read in road data in Texas is necessary to take account of light pollution that comes from roads. 
```{r}
#| output: false

# set a query so only highways are selected
road_query <- "SELECT * FROM gis_osm_roads_free_1 WHERE fclass='motorway'"

# read in road data
highways <- st_read(here::here("data/gis_osm_roads_free_1.gpkg"), query = road_query)

```
Part of this analysis will quantify the number of houses that experienced blackouts.Read in homes data. 
```{r}
#| output: false

# select for residential buildings
query_house <- "SELECT *
FROM gis_osm_buildings_a_free_1
WHERE (type IS NULL AND name IS NULL)
OR type in ('residential', 'apartments', 'house', 'static_caravan', 'detached')"

# read in house data
houses <- st_read(here::here("data/gis_osm_buildings_a_free_1.gpkg"), query = query_house)
```
```{r}
#| output: false

# look at what layers are necessary for this analysis
st_layers(here::here("data", "ACS_2019_5YR_TRACT_48_TEXAS.gdb"))
```
Read in the Texas census tract geomoetry data and Texas census tract socioeconomic data.
```{r}
#| output: false

# read in socioeconomic geometry data 
texas <- st_read(here::here("data", "ACS_2019_5YR_TRACT_48_TEXAS.gdb"), layer = "ACS_2019_5YR_TRACT_48_TEXAS")

# read in socioeconomic income data
texas_income <- read_sf(here::here("data", "ACS_2019_5YR_TRACT_48_TEXAS.gdb"), layer = "X19_INCOME")

```

## Function to Check CRS 
```{r}
match_crs <- function(df1, df2){
  if (st_crs(df1)==st_crs(df2)){
  print("it's a match!")
}else {
    warning("still not a match")
}}
```

## Check CRS of lights data frames
```{r}
match_crs(light1_0207, light2_0207)
match_crs(light3_0216, light4_0216)
```

# Merge data for the entirety of the days 
We use st_mosaic in this instance since the extents are different.
```{r}
# combine the data for each date
light_0207 <- st_mosaic(light1_0207, light2_0207)
light_0216 <- st_mosaic(light3_0216, light4_0216)
```

# Create original luminance maps 
#### Crop (spatially subset) the blackout mask to the Houston area as defined by the following coordinates: (-96.5, 29), (-96.5, 30.5), (-94.5, 30.5), (-94.5, 29)
```{r}
# set the dimensions for a bbox for the Houston area
crop_bbox <- st_bbox(c(xmin = -96.5, 
                       ymin = 29, 
                       xmax = -94.5, 
                       ymax= 30.5), 
                     crs = st_crs(light_0207))
```

```{r}
# crop light data on 02/07 with the bbox
light_0207 <- st_crop(light_0207, crop_bbox)

# crop light data on 02/16 with the bbox
light_0216 <- st_crop(light_0216, crop_bbox)
```
### Plot light for February 07, 2021
```{r}
# initial plotting exploration
plot(light_0207)
```

```{r}
# plot february 7th 2021 luminence using tmaps
lum_0207 <- tm_shape(light_0207) +
  tm_raster(palette = c('black', 
                        '#58544C',
                        'darkgrey', 
                        'grey', 
                        'lightgrey', 
                        'white'),
            breaks = c(0, 400, 800, 1200, 2400, 4800, 20000),
            title = "Luminance nW cm-2sr-1") +
  tm_title("Pre-Blackout Houston Luminance Map February 7, 2021") +
  tm_compass(position = tm_pos_out("right", "bottom")) +
  tm_scalebar(position = tm_pos_out("right", "bottom"))

# save map for better visual quality
tmap_save(lum_0207, 
          here::here("maps", "lum_0207.png"),
          height = 8, 
          width = 14)
```

### Plot light for February 16, 2021
```{r}
# initial plotting exploration
plot(light_0216)
```

```{r}
# plot february 16, 2021 luminance
lum_0216 <- tm_shape(light_0216) +
  tm_raster(palette = c('black', 
                        '#58544C',
                        'darkgrey', 
                        'grey', 
                        'lightgrey',
                        'white'),
            breaks = c(0, 400, 800, 1200, 2400, 4800, 20000),
            title = "Luminance nW cm-2sr-1") +
  tm_title("Houston Luminance Map for Blackout February 16, 2021") +
   tm_compass(position = tm_pos_out("right", "bottom")) +
   tm_scalebar(position = tm_pos_out("right", "bottom")) 

# save map for better visual quality
tmap_save(lum_0216, 
          here::here("maps", "lum_0216.png"),
          height = 8, 
          width = 14)
```
```{r}
# print out maps next to each other 
tmap_arrange(lum_0207, lum_0216)
```

# Create blackout mask
### Find the change in night lights intensity (presumably) caused by the storm
Calculate blackout data based on the difference in luminance before and after the blackout
```{r}
# blackout calculation
blackout <- light_0207 - light_0216 

# assign NA to any value less than 200
blackout[blackout < 200 ] <- NA
```


### Re-project the cropped blackout dataset to EPSG:3083 (NAD83 / Texas Centric Albers Equal Area) and Map the Blackedout Areas
```{r}
blackout <- blackout |> 
  st_transform(crs=st_crs('EPSG:3083'))
```


```{r} 
# create map of the blackout
blackout_map <- tm_shape(blackout) + 
  tm_raster(palette = c('black', 
                        '#58544C',
                        'darkgrey', 
                        'grey', 
                        'lightgrey',
                        'white'),
            breaks = c(0, 500, 800, 1200, 2400, 4800, 10000),
            title = "Luminance differences nW cm-2sr-1") +
  tm_title("Houston Blackout Areas February 2021") +
   tm_compass(position = tm_pos_out("right", "bottom")) +
  tm_scalebar(position = tm_pos_out("right", "bottom"))

tmap_save(blackout_map, 
          here::here("maps", "blackout_map.png"),
          height = 8, 
          width = 14)

blackout_map
```



# Exclude highways from the cropped blackout mask
#### Change CRS for highways and homes to match the blackout maks
```{r}
# change crs to texas crs
highways <- st_transform(highways, crs = st_crs('EPSG:3083'))
houses <- st_transform(houses, crs = st_crs('EPSG:3083'))
```

```{r}
# look at the units for the highways, the analysis is based on meters
st_crs(highways, parameters = TRUE)$units_gdal
```


```{r}
# union the highways data 
highways <- st_union(highways)

# identify areas within 200m of all highways into a buffer
highway_buffer <- st_buffer(highways, dist = 200)

```

```{r}
# make sure geometry is valid 
if (unique(st_is_valid(highway_buffer)) == TRUE){
  print("Vectors are valid!")
}else {
    warning("Not all vectors valid")
}
```
```{r}
# verify crs match
match_crs(highway_buffer, blackout)
```

```{r}
# change blackout data to a vector 
st_blackout <- st_as_sf(blackout)

# make sure geometry is valid 
if (unique(st_is_valid(st_blackout)) == TRUE){
  print("Vectors are valid!")
}else {
    warning("Not all vectors valid")
}
```

Find true blackout areas that are further than 200 meters from a highway
```{r}
# find true blackout areas that are further than 200 meters from a highway
true_blackout <- st_difference(st_blackout, highway_buffer)
```

# Identify the number of homes likely impacted by blackouts
```{r}
# make sure crs match 
match_crs(true_blackout, houses)

# find number of homes that intersect with the blackout data            
blackedout_homes <- st_intersection(true_blackout, houses)
```
Approximately **169,469 homes** were likely impacted by the blackouts in Houston according to this remote geo-spatial analysis. This analysis is based on any home that intersected with the blackout areas. Some of the homes in the intersection may not have experienced blackouts but were included due to the limitations of the data and constraints of geo-spatial analysis. On the other hand, some homes that were not living where luminence exists regularly and experienced a blackout may not have been counted.
```{r}
# map homes that experience blackouts with visuals of the roads that were buffered
homes_w_road_buff <- tm_shape(blackedout_homes) +
  tm_polygons() +
  tm_shape(highway_buffer) +
  tm_lines(col = '#ED6A5A') +
  tm_add_legend(title = "Roads",
                 type = "line",
                 labels = "highway") +
   tm_title("Houston Homes in Blackout Areas and Roads February 2021") +
   tm_compass(position = tm_pos_out("right", "bottom")) +
   tm_scalebar(position = tm_pos_out("right", "bottom"))

# save map for better visual quality
tmap_save(homes_w_road_buff, 
          here::here("maps", "homes_w_road_buff.png"),
          height = 8, 
          width = 14)

# print map 
homes_w_road_buff
```
### Combine Texas geometry with socioeconomic data
```{r}
# change the geometry column name to match between layers
texas_income <- texas_income |> 
  rename("GEOID_Data" = "GEOID")
```

```{r}
# join the Texas geometry with Texas income data
texas_socioeconomics <- left_join(texas, texas_income, by = "GEOID_Data")
```
### Crop for only Houston 
```{r}
# make a bbox for Houston in the Texas socioeconomic data crs
bbox <- st_bbox(c(xmin = -96.5, 
                  ymin = 29, 
                  xmax = -94.5, 
                  ymax= 30.5), 
                crs = st_crs(texas_socioeconomics))

# crop Texas socioeconomic data to Houston
texas_socioeconomics <- st_crop(texas_socioeconomics, bbox)
```


```{r}
#| warning: true

# make sure crs are the same for the socioeconomic data and blackedout homes
match_crs(texas_socioeconomics, blackedout_homes)
```


```{r}
#| output: false

# change mismatched crs to match 
texas_socioeconomics <- st_transform(texas_socioeconomics, 
                                     crs = st_crs('EPSG:3083'))
```

```{r}
#| output: false

# remove data frames that are no longer necessary
rm(texas)
rm(light1_0207)
rm(light2_0207)
rm(light3_0216)
rm(light4_0216)
```

#### Create a dataframe that includes socioeconomic data for only the homes that experienced blackouts
```{r}
# intersect socioeconomic data and homes data 
blackedout_socioecon <- st_filter(texas_socioeconomics, blackedout_homes) |> 
  mutate(blackedout = TRUE)
```

Based on the metadata, median household income in the past 12 months is column 'B19013e1'. Subset the data frame to only include necessary columns. 
```{r}
# select only necessary columns
census_blackedout <- blackedout_socioecon[, c("GEOID_Data", "TRACTCE", "B19013e1", "blackedout")]
```
#### Create a data frame that identifies whether the homes did or did not experience a blackout
```{r}
# add a true/false column for all homes on whether they experienced a blackout
census <- texas_socioeconomics |> 
  mutate(blackedout =  texas_socioeconomics$GEOID_Data %in% census_blackedout$GEOID_Data)
```

### Map displaying census tracts that experienced blackouts
```{r}
census_map <- tm_shape(census) + 
   tm_polygons() +
  tm_shape(blackedout_socioecon, is.main = TRUE) +
  tm_polygons(fill = '#ED6A5A') +
  tm_title("Houston Area Census Tracts that Experienced Blackouts February 2021") +
   tm_compass(position = tm_pos_out("right", "bottom")) +
  tm_scalebar(position = tm_pos_out("right", "bottom"))

# save map for better visual quality
tmap_save(census_map, 
          here::here("maps", "census_map.png"),
          height = 8, 
          width = 14)

# print census tract map
census_map
```
### Visualize income for areas that experienced blackouts and those that did not experience blackouts
```{r}
#| fig-cap: "True characterizes data for census tracts that experienced blackouts. False characterizes data for census tracts that did not experience blackouts."

# create histograms of incomes between those census tracts that experienced blackouts and those that did not
 ggplot(census, aes(B19013e1))+
  geom_histogram(color = 'Black', fill = "#F6CA83") +
  labs(x = "Income",
       y = "Frequency",
       title = "Income Level for Homes that Experienced Blackouts")+
  theme_minimal() +
  facet_wrap(~ blackedout, 
             ncol = 2, 
             scales = "free_x",
             strip.position = "bottom") + # unique on blackout 
  theme(strip.placement = "outside")
```

```{r}
#| fig-cap: "True characterizes data for census tracts that experienced blackouts. False characterizes data for census tracts that did not experience blackouts."

# create boxplots of incomes between those census tracts that experienced blackouts and those that did not
ggplot(census, aes(y = B19013e1))+
  geom_boxplot(width = 0.5) +
  labs(x = "Income",
       y = "Income",
       title = "Median Income Level for Homes and Their Blackout Experience") +
  theme_minimal() +
  facet_wrap(~blackedout, strip.position = "bottom") +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())
```
#### Identify how many census tracts did experience blackouts in the Houston area and how many did not experience blackouts in the Houston area.
```{r}
table(census$blackedout)
```

# Map and data analysis

According to our remote sensing analysis of difference in luminance in Houston, Texas between February 7th and February 16th 2021, most census tracts in Houston experienced blackouts. To be exact, 755 census tracts experienced blackouts, while only 357 did not experience blackouts. Though the expectation is that homes with higher incomes would experience less blackouts, the histogram and boxplot show it was a universal experience in Houston regardless of income. There are inherent limitations in geo-spatial data computations. The analysis does not allow for a true count of homes that have experienced blackouts, as some homes may exist in areas without an amount of luminance perceptible to satellites. These homes would be left out of any counts of the true span of the blackout if they did experience outages. Similarly, homes may have experienced no blackouts but may have been in a vicinity with many other homes losing power and counted, nonetheless. Overall, this analysis provides insight into the vast number of homes affected by electricity outages but should not be used to give accurate statistics on the incident. 

# Refrences
Census Data.[American Community Survey](https://www.census.gov/programs-surveys/acs)

NASA LAADS Data.[Level-1 and Atmosphere Archive & Distribution System
Distributed Active Archive Center
Version: 3.1.18.2](https://ladsweb.modaps.eosdis.nasa.gov/)

OpenStreetMap (OSM). Obtained through [Geofabrik](https://www.geofabrik.de/data/shapefiles.html)
